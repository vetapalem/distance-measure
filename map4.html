<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>  Distance Finder - Current Location to Destination</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .controls-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        #status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }

        .loading {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .warning {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ff9800;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #ccc;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        .destination-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .destination-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            padding: 10px;
            font-size: 14px;
        }

        .custom-destination {
            margin: 15px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .input-group {
            margin: 10px 0;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .distance-result {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            margin: 10px 0;
        }

        .distance-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .distance-unit {
            font-size: 1.2em;
            color: #666;
        }

        .route-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .info-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .user-location {
            background: #ff4444;
        }

        .destination-location {
            background: #44aa44;
        }

        .route-line {
            background: #667eea;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üìç Distance Finder</h1>
        <p class="subtitle">Calculate distances from your current location to any destination</p>

        <div id="status" class="loading">
            üó∫Ô∏è Initializing Distance Finder...
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color user-location"></div>
                <span>Your Current Location</span>
            </div>
            <div class="legend-item">
                <div class="legend-color destination-location"></div>
                <span>Destination</span>
            </div>
            <div class="legend-item">
                <div class="legend-color route-line"></div>
                <span>Route/Distance Line</span>
            </div>
        </div>

        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
            </div>

            <div class="controls-panel">
                <h3>üöÄ Quick Destinations</h3>
                <div class="destination-buttons">
                    <button class="destination-btn" onclick="calculateDistanceToLandmark('restaurant')">
                        üçΩÔ∏è Nearest Restaurant
                    </button>
                    <button class="destination-btn" onclick="calculateDistanceToLandmark('hospital')">
                        üè• Nearest Hospital
                    </button>
                    <button class="destination-btn" onclick="calculateDistanceToLandmark('airport')">
                        ‚úàÔ∏è Nearest Airport
                    </button>
                    <button class="destination-btn" onclick="calculateDistanceToLandmark('park')">
                        üå≥ Nearest Park
                    </button>
                </div>

                <div class="custom-destination">
                    <h3>üéØ Custom Destination</h3>
                    <div class="input-group">
                        <input type="text" id="destinationName" placeholder="Destination name (e.g., Home, Office)"
                            value="My Destination">
                    </div>
                    <div class="input-group">
                        <input type="number" id="destLat" placeholder="Latitude" step="any" value="40.7128">
                    </div>
                    <div class="input-group">
                        <input type="number" id="destLng" placeholder="Longitude" step="any" value="-74.0060">
                    </div>
                    <button onclick="calculateCustomDistance()">
                        üìè Calculate Custom Distance
                    </button>
                </div>

                <div class="controls">
                    <button onclick="getUserLocation()" id="refreshBtn">
                        üîÑ Get My Current Location
                    </button>
                    <button onclick="clearRoute()" id="clearBtn">
                        üóëÔ∏è Clear Route
                    </button>
                </div>
            </div>
        </div>

        <div class="results-panel" id="resultsPanel" style="display: none;">
            <h3>üìä Distance Results</h3>
            <div id="distanceResult" class="distance-result">
                <!-- Results will be displayed here -->
            </div>
            <div class="route-info" id="routeInfo">
                <!-- Additional route info will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Global variables
        let map;
        let userMarker;
        let destinationMarker;
        let routeLine;
        let userLocation = null;
        let currentDestination = null;

        // Popular landmarks with coordinates
        const landmarks = {
            restaurant: {
                name: "Nearest Restaurant",
                lat: 0,
                lng: 0,
                icon: "üçΩÔ∏è"
            },
            hospital: {
                name: "Nearest Hospital",
                lat: 0,
                lng: 0,
                icon: "üè•"
            },
            airport: {
                name: "Nearest Airport",
                lat: 0,
                lng: 0,
                icon: "‚úàÔ∏è"
            },
            park: {
                name: "Nearest Park",
                lat: 0,
                lng: 0,
                icon: "üå≥"
            }
        };

        // Initialize the application
        function initApp() {
            updateStatus('üó∫Ô∏è Initializing map and location services...', 'loading');
            initializeMap(40.7128, -74.0060, 10); // Default to New York
            getUserLocation();
        }

        // Get user's current location
        function getUserLocation() {
            updateStatus('üìç Getting your current location...', 'loading');
            disableButtons(true);

            if (!navigator.geolocation) {
                updateStatus('‚ùå Geolocation is not supported by your browser', 'error');
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 60000
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    userLocation = { lat, lng, accuracy };

                    updateStatus('‚úÖ Location found! Ready to calculate distances.', 'success');
                    updateUserLocationOnMap(lat, lng);
                    generateLandmarksAroundUser(lat, lng);
                    enableButtons();
                },
                (error) => {
                    handleLocationError(error);
                },
                options
            );
        }

        // Handle location errors
        function handleLocationError(error) {
            let errorMessage = '‚ùå ';

            switch (error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Location access was denied. Please allow location access.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information is unavailable.';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out. Please try again.';
                    break;
                default:
                    errorMessage += 'An unknown error occurred.';
                    break;
            }

            updateStatus(errorMessage, 'error');
            enableButtons();
        }

        // Initialize the map
        function initializeMap(lat, lng, zoom) {
            map = L.map('map').setView([lat, lng], zoom);

            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
        }

        // Update user location on map
        function updateUserLocationOnMap(lat, lng) {
            // Clear existing user marker
            if (userMarker) {
                map.removeLayer(userMarker);
            }

            // Create user location marker
            const userIcon = L.divIcon({
                className: 'user-location-marker',
                html: 'üìç<div style="font-size: 9px; text-align: center; color: #ff4444; font-weight: bold;">YOU</div>',
                iconSize: [35, 45],
                iconAnchor: [17, 45]
            });

            userMarker = L.marker([lat, lng], { icon: userIcon })
                .addTo(map)
                .bindPopup(`
                    <div style="text-align: center; min-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #ff4444;">üéØ Your Location</h4>
                        <p style="margin: 5px 0;"><strong>Latitude:</strong> ${lat.toFixed(6)}</p>
                        <p style="margin: 5px 0;"><strong>Longitude:</strong> ${lng.toFixed(6)}</p>
                        <p style="margin: 5px 0; font-size: 12px; color: #666;">Ready to calculate distances!</p>
                    </div>
                `)
                .openPopup();

            // Center map on user location
            map.setView([lat, lng], 14);
        }

        // Generate landmarks around user location
        function generateLandmarksAroundUser(userLat, userLng) {
            Object.keys(landmarks).forEach(key => {
                // Generate random coordinates within 5km radius
                const radius = 0.045; // ~5km at equator
                landmarks[key].lat = userLat + (Math.random() - 0.5) * radius;
                landmarks[key].lng = userLng + (Math.random() - 0.5) * radius;
            });
        }

        // Calculate distance to a predefined landmark
        function calculateDistanceToLandmark(landmarkType) {
            if (!userLocation) {
                updateStatus('‚ùå Please get your location first', 'error');
                return;
            }

            const landmark = landmarks[landmarkType];
            if (!landmark) {
                updateStatus('‚ùå Invalid destination', 'error');
                return;
            }

            calculateAndDisplayDistance(
                userLocation.lat,
                userLocation.lng,
                landmark.lat,
                landmark.lng,
                landmark.name,
                landmark.icon
            );
        }

        // Calculate distance to custom destination
        function calculateCustomDistance() {
            if (!userLocation) {
                updateStatus('‚ùå Please get your location first', 'error');
                return;
            }

            const destLat = parseFloat(document.getElementById('destLat').value);
            const destLng = parseFloat(document.getElementById('destLng').value);
            const destName = document.getElementById('destinationName').value || 'Custom Destination';

            if (isNaN(destLat) || isNaN(destLng)) {
                updateStatus('‚ùå Please enter valid coordinates', 'error');
                return;
            }

            calculateAndDisplayDistance(
                userLocation.lat,
                userLocation.lng,
                destLat,
                destLng,
                destName,
                'üéØ'
            );
        }

        // Main function to calculate and display distance
        function calculateAndDisplayDistance(startLat, startLng, endLat, endLng, destName, destIcon) {
            updateStatus('üìè Calculating distance...', 'loading');

            // Calculate distance
            const distance = calculateHaversineDistance(startLat, startLng, endLat, endLng);
            const drivingDistance = distance * 1.3; // Approximate driving distance (30% longer)
            const walkingDistance = distance * 1.1; // Approximate walking distance

            // Calculate estimated travel times
            const drivingTime = (drivingDistance / 50) * 60; // 50 km/h average speed
            const walkingTime = (walkingDistance / 5) * 60;  // 5 km/h walking speed

            // Update destination
            currentDestination = {
                name: destName,
                lat: endLat,
                lng: endLng,
                icon: destIcon
            };

            // Update map with destination and route
            updateMapWithDestination(startLat, startLng, endLat, endLng, destName, destIcon);

            // Display results
            displayDistanceResults(distance, drivingDistance, walkingDistance, drivingTime, walkingTime, destName);

            updateStatus(`‚úÖ Distance calculated to ${destName}`, 'success');
        }

        // Calculate distance using Haversine formula
        function calculateHaversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // Update map with destination marker and route line
        function updateMapWithDestination(startLat, startLng, endLat, endLng, destName, destIcon) {
            // Clear previous destination and route
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
            }
            if (routeLine) {
                map.removeLayer(routeLine);
            }

            // Create destination marker
            const destIconHtml = L.divIcon({
                className: 'destination-marker',
                html: `${destIcon}<div style="font-size: 9px; text-align: center; color: #44aa44; font-weight: bold;">DEST</div>`,
                iconSize: [35, 45],
                iconAnchor: [17, 45]
            });

            destinationMarker = L.marker([endLat, endLng], { icon: destIconHtml })
                .addTo(map)
                .bindPopup(`
                    <div style="text-align: center; min-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #44aa44;">${destIcon} ${destName}</h4>
                        <p style="margin: 5px 0;"><strong>Latitude:</strong> ${endLat.toFixed(6)}</p>
                        <p style="margin: 5px 0;"><strong>Longitude:</strong> ${endLng.toFixed(6)}</p>
                    </div>
                `)
                .openPopup();

            // Create route line
            routeLine = L.polyline([[startLat, startLng], [endLat, endLng]], {
                color: '#667eea',
                weight: 5,
                opacity: 0.7,
                dashArray: '10, 10',
                lineJoin: 'round'
            }).addTo(map);

            // Fit map to show both points
            const bounds = L.latLngBounds([[startLat, startLng], [endLat, endLng]]);
            map.fitBounds(bounds, { padding: [50, 50] });
        }

        // Display distance results
        function displayDistanceResults(distance, drivingDistance, walkingDistance, drivingTime, walkingTime, destName) {
            const resultsPanel = document.getElementById('resultsPanel');
            const distanceResult = document.getElementById('distanceResult');
            const routeInfo = document.getElementById('routeInfo');

            // Convert to miles for US audience
            const distanceMiles = distance * 0.621371;
            const drivingDistanceMiles = drivingDistance * 0.621371;

            distanceResult.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #333;">${destName}</h3>
                <div class="distance-value">${distance.toFixed(2)}</div>
                <div class="distance-unit">kilometers</div>
                <div style="margin-top: 10px; color: #666;">or ${distanceMiles.toFixed(2)} miles</div>
                <div style="margin-top: 15px; font-size: 14px; color: #888;">
                    Straight line distance from your current location
                </div>
            `;

            routeInfo.innerHTML = `
                <div class="info-card">
                    <div class="info-value">${drivingDistance.toFixed(2)} km</div>
                    <div class="info-label">Driving Distance</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${Math.round(drivingTime)} min</div>
                    <div class="info-label">Driving Time</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${walkingDistance.toFixed(2)} km</div>
                    <div class="info-label">Walking Distance</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${Math.round(walkingTime)} min</div>
                    <div class="info-label">Walking Time</div>
                </div>
            `;

            resultsPanel.style.display = 'block';
        }

        // Clear current route
        function clearRoute() {
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
                destinationMarker = null;
            }
            if (routeLine) {
                map.removeLayer(routeLine);
                routeLine = null;
            }

            document.getElementById('resultsPanel').style.display = 'none';
            updateStatus('üóëÔ∏è Route cleared. Ready for new calculations.', 'success');

            // Re-center on user location
            if (userLocation) {
                map.setView([userLocation.lat, userLocation.lng], 14);
                if (userMarker) {
                    userMarker.openPopup();
                }
            }
        }

        // Update status message
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
        }

        // Enable/disable buttons
        function disableButtons(disabled) {
            document.getElementById('refreshBtn').disabled = disabled;
            document.getElementById('clearBtn').disabled = disabled;
        }

        function enableButtons() {
            document.getElementById('refreshBtn').disabled = false;
            document.getElementById('clearBtn').disabled = false;
        }

        // Add custom CSS for markers
        const style = document.createElement('style');
        style.textContent = `
            .user-location-marker {
                background: transparent;
                border: none;
                text-align: center;
                font-size: 28px;
                filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            }
            .destination-marker {
                background: transparent;
                border: none;
                text-align: center;
                font-size: 28px;
                filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            }
        `;
        document.head.appendChild(style);

        // Initialize the application when page loads
        window.addEventListener('load', initApp);
    </script>
</body>

</html>
